gavrasm Gerd's AVR assembler version 3.3 (C)2012 by DG4FAC
----------------------------------------------------------
Source file: main1.asm
Hex file:    main1.hex
Eeprom file: main1.eep
Compiled:    13.05.2014, 12:29:56
Pass:        2
     1: ;source by: Duality / Robert
     2: ;Edited 13 - 5 - 2014
     3: ;start working on implementing intterupts in assembly.
     4: ;will make a walking light with interrupts timmers and leds.
     5: ;note a rjmp(relative jump) can't jump as far as a jmp (jump)
     6: ;but is faster, where jmp is slower.
     7: ;rjmp can only jump 2047 up or down.
     8: .include "m16def.inc"
 -> Warning 009: Include defs not necessary, using internal values!
   File: main1.asm, Line: 8
   Source line: .include "m16def.inc"
     9: 
    10: ;.def's are symbolic names for registers.
    11: ;.equ's are symbolic names for constant value's.
    12: 
    13: .def temp = r16
    14: 
    15: ;interrupts have to be handled in line of priority.
    16: ;for button interrupt routine
    17: .org INT0addr
    18: 000002   940C  jmp buttonInterruptRoutine
        000003   000D
    19: ;for interrupt handeling timer routine
    20: .org OC1Aaddr
    21: 00000C   940C  jmp timer1InterruptRoutine
        00000D   0018
    22: 
    23: ;data segment
    24: .dseg
    25: 	.org SRAM_START
    26: 	;everything here is in ram. like lists and such.
    27: 	val_count: .BYTE 1
    28: 
    29: ;code segment
    30: .cseg
    31: .org 0x00
    32: 	;initialize registers to zero if needed
    33: 	;initialize status registers if needed
    34: 000000   9478  sei ;enalbe interrupts
    35: 	;initialize pins
    36: 	
    37: 	;initialize the stack
    38: 000001   E50F  ldi r16, low(RAMEND)
    39: 000002   BF0D  out SPL, r16
    40: 000003   E004  ldi r16, high(RAMEND)
    41: 000004   BF0E  out SPH, r16
    42: 	
    43: 	;setup timer
    44: 000005   C008  rjmp timerSetup
    45: 	;setup led use
    46: 000006   C003  rjmp setupDebugLed
    47: 	;setup button use
    48: 000007   C004  rjmp buttonSetup
    49: 	;jump to main routine.
    50: 000008   C000  rjmp main
    51: 
    52: main:
    53: 000009   CFFF  rjmp main
    54: 
    55: setupDebugLed:
    56: 00000A   9508  ret
    57: toggleLed:
    58: 00000B   9508  ret
    59: 
    60: ;routing for setting up the button.
    61: buttonSetup:
    62: 00000C   9508  ret
    63: ;button interrupt service routine.
    64: buttonInterruptRoutine:
    65: 00000D   9518  reti
    66: 
    67: ;routine for setting up timer use
    68: ;using timer 1
    69: timerSetup:
    70: 	;interupt on compare value.
    71: 00000E   E00D  ldi temp, (1<<CS12)|(1<<CS10)|(1<<WGM12);prescaler of 1024 and ctc mode.
    72: 00000F   BD0E  out TCCR1B, temp
    73: 000010   E100  ldi temp, (1<<OCIE1A)
    74: 000011   BF09  out TIMSK, temp
    75: 	;compare on value of 781 for a pulse a second.
    76: 000012   E00D  ldi temp, low(781)
    77: 000013   BD0A  out OCR1AL, temp
    78: 000014   E003  ldi temp, high(781)
    79: 000015   BD0B  out OCR1AH, temp
    80: 000016   9478  sei
    81: 000017   9508  ret
    82: ;timer interrupt service routine
    83: timer1InterruptRoutine:
    84: 	;toggle led for debugging
    85: 000018   940C  jmp toggleLed
        000019   000B
    86: 	;load pointer to value
    87: 00001A   E6E0  ldi ZL, low(val_count)
    88: 00001B   E0F0  ldi ZH, high(val_count)
    89: 	;load count value into temp
    90: 00001C   8100  ld temp, Z
    91: 00001D   9503  inc temp ;increment temp;
    92: 00001E   8300  st Z, temp;store value
    93: 00001F   9518  reti

Program             :       36 words.
Constants           :        0 words.
Total program memory:       36 words.
Eeprom space        :        0 bytes.
Data segment        :        1 bytes.
Compilation completed, no errors.
Compilation endet 13.05.2014, 12:29:56
